!function(e){var t={};function i(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){},function(e,t,i){"use strict";i.r(t);class r{constructor(e,t,i,r,a){this.popup=t,this.cardList=i,this.selector=e,this.validationMessage=r,this.afterSaveHandler=a,this.submitButton=document.querySelector(".popup__button"),this.addEventListener()}validate(){this.isValidFields()?(this.submitButton.removeAttribute("disabled"),this.submitButton.classList.add("popup__button_enabled")):(this.submitButton.setAttribute("disabled",!0),this.submitButton.classList.remove("popup__button_enabled"))}isValidFields(){return null===this.getValidateErrorLinkField()&&null===this.getValidateErrorPlaceField()}validatePlaceField(){document.querySelector("#error-place").textContent=this.getValidateErrorPlaceField()}validateLinkField(){document.querySelector("#error-link").textContent=this.getValidateErrorLinkField()}getValidateErrorPlaceField(){const e=document.querySelector("#place");return 0===e.value.length?this.validationMessage.required:e.value.length<2||e.value.length>30?this.validationMessage.wrongLength:null}getValidateErrorLinkField(){const e=document.querySelector("#link");return e.validity.typeMismatch?this.validationMessage.linkError:0===e.value.length?this.validationMessage.required:null}save(e){e.preventDefault();let t=this.selector.elements.name,i=this.selector.elements.link;this.afterSaveHandler(t.value,i.value).then(e=>{let t=this.cardList.onCreateCardHandler(e);this.cardList.addCard(t),this.popup.close(),document.forms.place.reset(),this.submitButton.setAttribute("disabled",!0),this.submitButton.classList.remove("popup__button_enabled")})}addEventListener(){this.submitButton.addEventListener("click",e=>{this.save(e)}),this.selector.addEventListener("input",()=>{this.validate()}),document.querySelector("#place").addEventListener("input",()=>{this.validatePlaceField()}),document.querySelector("#link").addEventListener("input",()=>{this.validateLinkField()})}getCardData(e,t){return{name:e.value,link:t.value}}}class a{constructor(e,t){this.elem=e,this.openLink=t,this.addEvents()}open(e){this.elem.classList.add("popup_is-opened")}close(){this.elem.classList.remove("popup_is-opened")}addEvents(){this.openLink.forEach(e=>{e.addEventListener("click",e=>{this.open(e)})}),this.elem.querySelector(".popup__close").addEventListener("click",()=>{this.close()})}}class s{constructor(e,t,i,r){this.api=i,this.likes=e.likes,this.name=e.name,this.link=e.link,this.id=e._id,this.ownerId=e.owner._id,this.profile=r,this.popup=t,this.likeListener=this.likeListenerHandler.bind(this),this.deleteListener=this.deleteListenerHandler.bind(this),this.openListener=this.openListenerHandler.bind(this)}createWithOwner(){return this._createBaseCard(),this._createDeleteIcon(),this.addEvents(),this.placeCard}create(){return this._createBaseCard(),this.addEvents(),this.placeCard}_createBaseCard(){return this._createCard(),this._createImage(),this._createCardDescription(),this._createCardName(),this._createLikeIcon(),this.placeCard}_createCard(){return this.placeCard=document.createElement("div"),this.placeCard.classList.add("place-card"),this.placeCard.setAttribute("data-id",this.id),this.placeCard.setAttribute("data-owner-id",this.ownerId),this}_createImage(){return this.placeCardImage=document.createElement("div"),this.placeCard.appendChild(this.placeCardImage),this.placeCardImage.classList.add("place-card__image"),this.placeCardImage.setAttribute("style","background-image: url(".concat(this.link,")")),this}_createDeleteIcon(){return this.placeCardDeleteIcon=document.createElement("button"),this.placeCardImage.appendChild(this.placeCardDeleteIcon),this.placeCardDeleteIcon.classList.add("place-card__delete-icon"),this}_createCardDescription(){return this.placeCardDescription=document.createElement("div"),this.placeCard.appendChild(this.placeCardDescription),this.placeCardDescription.classList.add("place-card__description"),this}_createCardName(){return this.placeCardName=document.createElement("h3"),this.placeCardDescription.appendChild(this.placeCardName),this.placeCardName.classList.add("place-card__name"),this.placeCardName.textContent="".concat(this.name),this}_createLikeIcon(){return this.placeCardLikeIcon=document.createElement("button"),this.placeCardDescription.appendChild(this.placeCardLikeIcon),this.placeCardLikeIcon.classList.add("place-card__like-icon"),void 0!==this.likes.find(e=>this.profile._id===e._id)&&this.placeCardLikeIcon.classList.add("place-card__like-icon_liked"),this}like(){this.placeCardLikeIcon.classList.contains("place-card__like-icon_liked")?(this.placeCardLikeIcon.classList.remove("place-card__like-icon_liked"),this.api.dislikeCard(this.id)):(this.placeCardLikeIcon.classList.add("place-card__like-icon_liked"),this.api.likeCard(this.id))}delete(e){e.target.classList.contains("place-card__delete-icon")&&(console.log(this.api),this.api.deleteCard(e.target.closest(".place-card").getAttribute("data-id")),e.target.closest(".place-card").remove(),this.removeEvents())}openPopup(e){this.popup.open(e,this.link)}addEvents(){this.placeCardLikeIcon.addEventListener("click",this.likeListener),this.placeCardDeleteIcon&&this.placeCardDeleteIcon.addEventListener("click",this.deleteListener),this.placeCard.addEventListener("click",this.openListener)}removeEvents(){this.placeCardLikeIcon.removeEventListener("click",this.likeListener),this.placeCardDeleteIcon&&this.placeCardDeleteIcon.removeEventListener("click",this.deleteListener),this.placeCard.removeEventListener("click",this.openListener)}deleteListenerHandler(e){this.delete(e)}likeListenerHandler(){this.like()}openListenerHandler(e){this.openPopup(e)}}const n={required:"Это обязательное поле",wrongLength:"Должно быть от 2 до 30 символов",linkError:"Здесь должна быть ссылка"};class l{constructor(e,t,i){this.containerClass=e,this.createCardHandler=i,this.viewCardPopup=t}render(e){for(let t=0;t<e.length;t++)this.containerClass.appendChild(this.onCreateCardHandler(e[t]))}addCard(e){this.containerClass.appendChild(e)}onCreateCardHandler(e){return this.createCardHandler(e,this.viewCardPopup)}}i(0);const d=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}getUserInfo(){return fetch(this.getUrl("/users/me"),{headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}getInitialCards(){return fetch(this.getUrl("/cards"),{headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}saveUserInfo(e,t){return fetch(this.getUrl("/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}addCard(e,t){return fetch(this.getUrl("/cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}deleteCard(e){return fetch(this.getUrl("/cards/")+e,{method:"DELETE",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}likeCard(e){return fetch(this.getUrl("/cards/like/")+e,{method:"PUT",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}dislikeCard(e){return fetch(this.getUrl("/cards/like/")+e,{method:"DELETE",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))).catch(e=>{alert("Что-то пошло не так. "+e)})}getUrl(e){return this.baseUrl+e}}({baseUrl:"https://praktikum.tk/cohort6",headers:{authorization:"96a71016-5850-4711-a632-4339a8c4303d","Content-Type":"application/json"}}),o=document.querySelector(".places-list"),c=new class extends a{open(e,t){e.target.classList.contains("place-card__image")&&(super.open(),document.querySelector(".photo-popup__img").setAttribute("src",t))}addEvents(){this.elem.querySelector(".popup__close").addEventListener("click",()=>{this.close()})}}(document.querySelector(".photo-popup"),document.querySelectorAll(".place-card__image")),u=new a(document.querySelector(".edit-popup"),document.querySelectorAll(".user-info__edit-button")),h=new a(document.querySelector(".popup"),document.querySelectorAll(".user-info__button"));d.getUserInfo().then(e=>{p.setData(e);const t=new l(o,c,(function(t,i){return e._id===t.owner._id?new s(t,i,d,e).createWithOwner():new s(t,i,d,e).create()}));d.getInitialCards().then(e=>{t.render(e)});new r(document.querySelector(".popup__form"),h,t,n,(function(e,t){return d.addCard(e,t)}))});const p=new class{constructor(e,t,i,r){this.popup=t,this.selector=e,this.validationMessage=i,this.submitButton=document.querySelector(".edit-popup__button"),this.afterSaveHandler=r,this.addEventListener()}setData(e){document.querySelector(".user-info__name").textContent=e.name,document.querySelector(".user-info__job").textContent=e.about,document.querySelector(".edit-popup__input_type_name").setAttribute("value",e.name),document.querySelector(".edit-popup__input_type_job").setAttribute("value",e.about)}validate(){this.isValidFields()?(this.submitButton.removeAttribute("disabled"),this.submitButton.classList.add("edit-popup__button_enabled")):(this.submitButton.setAttribute("disabled",!0),this.submitButton.classList.remove("edit-popup__button_enabled"))}isValidFields(){return null===this.getValidateErrorJobField()&&null===this.getValidateErrorUsernameField()}validateUsernameField(){document.querySelector("#error-username").textContent=this.getValidateErrorUsernameField()}validateJobField(){document.querySelector("#error-job").textContent=this.getValidateErrorJobField()}getValidateErrorUsernameField(){const e=document.querySelector("#username");return 0===e.value.length?this.validationMessage.required:e.value.length<2||e.value.length>30?this.validationMessage.wrongLength:null}getValidateErrorJobField(){const e=document.querySelector("#job");return 0===e.value.length?this.validationMessage.required:e.value.length<2||e.value.length>30?this.validationMessage.wrongLength:null}save(e){e.preventDefault();const t=document.querySelector(".user-info__name"),i=document.querySelector(".user-info__job"),r=this.selector.elements.name,a=this.selector.elements.job;t.textContent=r.value,i.textContent=a.value,this.popup.close(),this.afterSaveHandler(r.value,a.value)}addEventListener(){this.submitButton.addEventListener("click",e=>{this.save(e)}),this.selector.addEventListener("input",()=>{this.validate()}),document.querySelector("#username").addEventListener("input",()=>{this.validateUsernameField()}),document.querySelector("#job").addEventListener("input",()=>{this.validateJobField()})}}(document.querySelector(".edit-popup__form"),u,n,(function(e,t){d.saveUserInfo(e,t)}))}]);